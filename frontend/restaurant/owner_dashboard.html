<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Restaurant Dashboard</title>
<link rel="stylesheet" href="../style.css">
</head>
<body>
<h1>Welcome, Restaurant Owner</h1>
<button onclick="logout()">Logout</button>

<section>
  <h2>Manage Menu</h2>
  <input type="text" id="item_name" placeholder="Item Name">
  <input type="number" id="item_price" placeholder="Price">
  <button onclick="addMenuItem()">Add Item</button>
  <ul id="menu_list"></ul>
</section>

<section>
  <h2>Incoming Orders</h2>
  <ul id="order_list"></ul>
</section>

<script>
const user = JSON.parse(localStorage.getItem("user"));
if (!user || user.role !== "restaurant") window.location.href="../login.html";

const API_BASE = "http://localhost/food%20delivery%20system/backend/restaurant";

function logout() {
  localStorage.removeItem("user");
  window.location.href="../login.html";
}

// Load menu
async function loadMenu() {
  const res = await fetch(`${API_BASE}/get_menu.php?restaurant_id=${user.user_id}`);
  const menu = await res.json();
  const container = document.getElementById("menu_list");
  container.innerHTML = menu.map(m => `<li>${m.name} - $${m.price}</li>`).join("");
}

// Add menu item
async function addMenuItem() {
  const name = document.getElementById("item_name").value;
  const price = document.getElementById("item_price").value;
  const formData = new FormData();
  formData.append("restaurant_id", user.user_id);
  formData.append("name", name);
  formData.append("price", price);

  const res = await fetch(`${API_BASE}/add_menu_item.php`, {method:"POST", body:formData});
  const data = await res.json();
  alert(data.message);
  loadMenu();
}

// Load orders
async function loadOrders() {
  const res = await fetch(`${API_BASE}/get_orders.php?restaurant_id=${user.user_id}`);
  const orders = await res.json();
  const container = document.getElementById("order_list");
  container.innerHTML = orders.map(o => `<li>${o.customer_name} (${o.customer_email}) - ${o.status} - ${o.created_at}</li>`).join("");
}

// Initial load
loadMenu();
loadOrders();
</script>
</body>
</html>
